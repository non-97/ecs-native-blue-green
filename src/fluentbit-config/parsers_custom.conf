# カスタムマルチラインパーサー定義（Node.jsのスタックトレース用）
# スタックトレースを1つのログレコードにまとめる
[MULTILINE_PARSER]
    name          nodejs_stacktrace
    type          regex
    flush_timeout 1000
    # 開始行: エラーメッセージや通常のログ（スタックトレース行以外）
    # スタックトレースは空白文字 + "at " で始まるため、それ以外を開始行とする
    rule          "start_state"  "/^(?!\s+at\s).*$/"  "cont"
    # 継続行: 1つ以上の空白文字 + "at " で始まるスタックトレース行
    rule          "cont"         "/^\s+at\s+.*$/"      "cont"

# JSONパーサー（タイムスタンプのパースの無効）
# pinoのISO 8601形式のタイムスタンプをそのまま保持
# Time_Keep On により、元のタイムスタンプフィールドを保持する
# ref : Parser | Fluent Bit: Official Manual https://docs.fluentbit.io/manual/data-pipeline/filters/parser#parsers.conf
[PARSER]
    Name          json_without_time
    Format        json
    Time_Keep     On
